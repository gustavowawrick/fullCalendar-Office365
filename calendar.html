<!DOCTYPE html>
<html lang='en'>

<head>
  <meta charset='utf-8' />
  <!-- Biblioteca FullCalendar -->
  <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js'></script>
  <!-- Biblioteca jQuery -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <!-- Ícones Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
  <!-- Estilo CSS -->
  <link href="style.css" rel="stylesheet">

  <title>Calendário</title>
</head>

<body>
  <div id='calendar'></div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const customLocale = {
        weekText: 'Semana',
        allDayText: 'Dia inteiro',
        moreLinkText: 'mais',
        today: 'Hoje',
        month: 'Mês',
        week: 'Semana',
        day: 'Dia',
        list: 'Lista',
        dayHeaderFormat: { weekday: 'long' },
      };

      var calendarEl = document.getElementById('calendar');
      var calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        themeSystem: 'bootstrap',
        headerToolbar: {
          left: 'today prev,next',
          center: 'title',
          right: 'dayGridMonth,timeGridWeek,timeGridDay,listWeek',
        },
        navLinks: true,
        nowIndicator: true,
        weekNumberCalculation: 'ISO',
        editable: true,
        selectable: true,
        dayMaxEvents: true,
        weekends: false,
        locale: 'pt-br',
        dayHeaderFormat: customLocale.dayHeaderFormat,
        buttonText: customLocale,
        timeZone: 'America/Sao_Paulo',
        eventContent: function (arg) {
          var viewType = arg.view.type;
          var content = '<div class="fc-content">';
          if (viewType === 'dayGridMonth') {
            content += '<div class="fc-bar"></div>';
            content += '<span class="fc-time">' + formatDate(arg.event.start) + '</span>';
            content += '<img src="img/iconTeams.png" alt="Ícone do Teams">';
            content += '<span class="fc-title">' + arg.event.title + '</span>';
          } else if (viewType === 'timeGridWeek' || viewType === 'timeGridDay') {
            content += '<span class="fc-title">' + arg.event.title + ' - </span>';
            content += '<span class="fc-author">' + arg.event.extendedProps.author + '; </span>';
            content += '<span class="fc-type">Reunião Microsoft Teams</span>';
          } else if (viewType === 'listWeek') {
            content += '<span class="fc-title">' + arg.event.title + ' - </span>';
            content += '<span class="fc-author">' + arg.event.extendedProps.author + '; </span>';
            content += '<span class="fc-type">Reunião Microsoft Teams</span>';
          }
          content += '</div>';
          return { html: content };
        },
        events: {
          url: 'consultaEventos.php',
          method: 'GET',
          extraParams: {
          },
          failure: function () {
            alert('Erro ao obter eventos do Office 365.');
          }
        }
      });

      calendar.render();

      function formatDate(date) {
        var localDate = new Date(date);
        return localDate.toLocaleString('pt-BR', { hour: '2-digit', minute: '2-digit', timeZone: 'America/Sao_Paulo' });
      }

      function getParameterByName(name, url = window.location.href) {
        name = name.replace(/[\[\]]/g, '\\$&');
        var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
          results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, ' '));
      }
    });
  </script>
</body>

</html>